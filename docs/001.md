## DevOps & Platform PoC — Status and Commands (WSL/Linux)

### What’s Done
- FastAPI app with Strawberry GraphQL router and CORS
- Health endpoint and basic API info
- Project model, CRUD resolvers, filtering, pagination
- Cosmos DB service (real client, CRUD, filters, pagination)
- Azure Storage service (real client, container auto-create, result logs)
- Environment configured (.env populated from your terminal values)
- Documentation: TODO, Quick Start, Implementation Guide

### What’s Pending
- Azure AD JWT auth middleware
- Tests (unit/integration)
- Containerize and deploy (ACI/AKS)
- Logic App orchestration (retries, error routing, Teams alerts)

---

### One-time Azure Setup (already done in your session)
```bash
# Login & set subscription
az login
az account set --subscription 8f1d9608-31ed-477c-bda8-73b27d438383

# Providers (run once if not registered)
az provider register --namespace Microsoft.Storage
az provider register --namespace Microsoft.DocumentDB
az provider register --namespace Microsoft.Web

# Cosmos DB (account/db/container)
az cosmosdb create \
  --name devopspoc-cosmos-23089 \
  --resource-group poc-rg-westus \
  --locations regionName=westus
az cosmosdb sql database create \
  --account-name devopspoc-cosmos-23089 \
  --resource-group poc-rg-westus \
  --name devops-poc
az cosmosdb sql container create \
  --account-name devopspoc-cosmos-23089 \
  --resource-group poc-rg-westus \
  --database-name devops-poc \
  --name projects \
  --partition-key-path "/id"

# Storage account & connection string
az storage account create \
  --name devopspocstg2025 \
  --resource-group poc-rg-westus \
  --location westus \
  --sku Standard_LRS \
  --kind StorageV2
az storage account show-connection-string \
  --name devopspocstg2025 \
  --resource-group poc-rg-westus
```

### Azure AD App (already created)
```bash
# App registration and secret
az ad app create --display-name "devops-poc-api" --sign-in-audience AzureADMyOrg
az ad app credential reset \
  --id 8e9b0923-b25b-4a60-b107-d488c52fe071 \
  --display-name "PoC-Secret" \
  --years 1
```

---

### Local Run (WSL/Linux)
```bash
# 1) Install deps (inside repo root)
python3 -m pip install -r requirements.txt

# 2) Verify config loads
python3 -c "from config.settings import get_settings; s=get_settings(); print('OK', s.API_HOST, s.API_PORT)"

# 3) Start API (foreground)
./.venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000
# or with autoreload
./.venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --reload

# 4) Health check
curl -v http://localhost:8000/health

# 5) GraphQL UI
# open in browser: http://localhost:8000/graphql
```

### Sample GraphQL
```graphql
# Create a project
mutation {
  createProject(input: {
    name: "DevOps Platform PoC"
    description: "PoC for DevOps platform"
    owner: "devops-team"
    team: "platform"
    priority: "HIGH"
    tags: ["poc", "devops", "azure"]
  }) {
    id
    name
    status
  }
}

# List projects
query {
  projects(
    filter: { status: "PLANNING" }
    pagination: { limit: 10, offset: 0, sort_by: "created_at", sort_order: "desc" }
  ) {
    id
    name
    owner
    team
    status
  }
}
```

### Troubleshooting (WSL/Linux)
- uvicorn not found in PowerShell: run via WSL path `./.venv/bin/uvicorn ...`
- pydantic_settings error: `pip install -r requirements.txt`
- Extra env keys error: remove unsupported vars from `.env`
- Cosmos DB 404 on container: ensure DB `devops-poc` and container `projects` exist (commands above)

### Notes
- Secrets live in `.env` (don’t commit). Use `env.example` as template.
- Blob container `api-results` is created on first run.
- Cosmos DB queries support filters, sorting, and pagination.
